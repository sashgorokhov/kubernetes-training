set -ex

API_SERVERS="https://master1.example.com"

if [ -f /etc/kubernetes/ssl/apiserver.pem ]; then
    CONFIG_DIR=/etc/kubernetes/shared/manifests/master
    ADDITIONAL_OPTS="--register-schedulable=false"
    API_SERVERS="https://127.0.0.1"
else
    CONFIG_DIR=/etc/kubernetes/shared/manifests/node
fi

set +ex

KUBELET_OPTS="--v=3
--api-servers=$API_SERVERS
--allow-privileged
--serialize-image-pulls=false
--master-service-namespace=kube-system
--register-node=true
--pod-manifest-path=$CONFIG_DIR
--logtostderr
--alsologtostderr
--enable-load-reader
--cluster-domain=cluster.local
--cluster-dns=10.10.0.10
--kubeconfig=/etc/kubernetes/shared/kubeconfig
--tls-cert-file=/etc/kubernetes/ssl/node.pem
--tls-private-key-file=/etc/kubernetes/ssl/node-key.pem
--node-ip=NODE_IP
$ADDITIONAL_OPTS"

echo KUBELET_OPTS=$KUBELET_OPTS